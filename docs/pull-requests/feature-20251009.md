
Please review the latest git repository content in the attached repo directory contents.
The file is a concatenation of the entire repo directory in text format containing the source code, configuration, README markdown, and the most recent test results file.

Please review the included root `README.md`, **dockerfile image source**, and **docker test file** for the **openbao-ansible** docker image.
The current image passes all tests defined in "test/test-openbao-container.sh".
The enhanced image passes all tests defined in "test/test-openbao-container.sh".

## Overview/Motivation

The **openbao-ansible** container should support idempotent configuration upon startup.

## Proposed Enhancement

Add the following new features/capabilities:

1) the "openbao_setup.sh" function should replace the policy functions ("create_admin_policy()", "create_user_policy()"), the user function ("create_test_user()") and the token function ("generate_admin_token()") with a python script that idempotently configures the openbao container sourcing configuration from a yaml configuration file with DRY method/approach. The python script should source the **policy**, **user**, and **token** configurations from the YAML configuration file instead of using hard-coded information for the policy, user, and token configurations.
2) Upon container start the container should invoke the "openbao_setup.sh" which then invokes the DRY python script to source and iterate through the specified YAML configuration containing lists of policy, user and token configuration dictionaries where each item dictionary contains the respective configuration.
3) The ansible vaulted json file should be reformatted to store each non-root token under a "tokens" node where each sub-key is the user ID and the value is the token).
4) The python script should source each policy configuration from the YAML configuration and ensure each policy exists according to definition.
5) The python script should source each user configuration from the YAML configuration and ensure each user exists according to definition.
   - The python script should determine if the respective user exists in the ansible vaulted json to determine is the user was already created
      - if the user was already created, the script should use the bao api to determine if the user still exists with the specified password
      - if the user does not still exist, recreate the user and set the password for the user to match the specified password and store the user password in the encrypted ansible vault json
6) The python script should source each token configuration from the YAML configuration and ensure each token exists according to definition.
   - The python script should determine if the respective token exists in the ansible vaulted json to determine is the token was already created
      - if the token was already created, the script should use the bao api to determine if the token still exists
      - if the token does not still exist, recreate the token and store the new token in the encrypted ansible vault json

Example openbao_config.yml:
```yaml
policies:
  admin:
    hcl_content: |
      path "*" {
        capabilities = ["create", "read", "update", "delete", "list", "sudo"]
      }
  user:
    hcl_content: |
      path "secret/*" {
        capabilities = ["create", "read", "update", "delete", "list"]
      }
      path "userpass/users/{{identity.entity.name}}" {
        capabilities = ["read"]
      }
      
users:
  - display_name: test_user
    password: test_password
    policies:
      - user

tokens:
  - display_name: admin
    policies:
      - admin
  - display_name: test_user
    policies:
      - user

```

Example enhanced ansible vaulted json:
```shell
/ $ openbao_info --content
{
  "unseal_keys_b64": [
    "kUg7l3uHmarvHwcyRv3HXu5tymCXMmxZgOE1UOkbSgpS",
    "YpEEnpE4qEd6U2GqL1R1DViDIgKhaVVU/wa7xEN20lUs",
    "ddGEbpqxsrEa5tLsaapdtGmNi73/Nbc/nRA+jyUtDXNb",
    "2taYN0dOkp2nZ5kgDyDl82azQLvIor7XP3/vOeUmd/Ty",
    "EHotWA8pVIrX0W4XIUQCPVfIRKpjGs9QOh3s2ber04BG"
  ],
  "unseal_keys_hex": [
    "4d543a46d28294b9b729825cc9b1660ee5dee1e66abbc7c1cc97b8e91481bf71d0",
    "20c880a85a55551de94d86a8bd51d43127a44e2a115ff06bbc4552c62914376d22",
    "698d8bbdf1b2dfcd6dcac46b9b4bb1a6a97446e9abf9d103e8f735b75d1252d0d8",
    "73f7c83effbce79499d97cd9acd02ef228ad837474e929da767f4f2dad699200f9",
    "7b366deaf4e0119f2112a98c6b3d40eb5603ca5522b5f45b85cf56107a85100831"
  ],
  "unseal_shares": 5,
  "unseal_threshold": 3,
  "recovery_keys_b64": [],
  "recovery_keys_hex": [],
  "recovery_keys_shares": 0,
  "recovery_keys_threshold": 0,
  "root_token": "s.K2ADgkFH0yr1uwk9klKhFBIh",
  users: {
    "test_user": "test_password"
  }
  tokens: {
    "admin": "s.yB3E6GWWPxBIzHxONajEo7dT"
  }
}
```

### Update Tests

Enhance existing tests if the respective regression feature and/or tests are impacted by the new feature enhancement(s);
Remove existing tests if the regression feature has been eliminated by the new feature enhancement(s);
Add new tests to verify the new features enhancement(s) work as intended / expected.
    - Add test to verify initial startup
    - Add test to run initialization then remove policy/user/token and restart to verify the container recreates the respective resource
    - Add test to run initialization then modify resource (policy/user/token) wherever appropriate and restart to verify the container ensures the respective resources are setup according to definition

## Developer Notes/Prompts

- Only incrementally enhance the code necessary with minimal change(s) to the existing module source logic.
- Only incrementally enhance the unit test file logic in order to achieve the highest test pass rate with lowest regression fail rate
- Use a `test-driven-development` (`TDD`) approach
- Use `don't-repeat-yourself` (`DRY`) methods whenever possible
- The enhancement(s) should pass all existing unit tests to `validate regression feature success`. 
- The enhancement(s) should pass all new feature tests to `validate new feature success`.
- Only remove test cases if they are acceptably deemed functionally redundant
- Maintain all unit test functions in alphanumeric sort order facilitating ease of code-difference comparison between versions
- When enhancing script functions and class methods, maintain all functions in alphanumeric sort order facilitating ease of diff comparison between versions 
- ONLY make minimal/incremental changes to existing regression unit tests if necessary.
- In most cases for minor enhancements, it is expected that there should be no or minimal changes to the existing unit tests. 
- Make the necessary updates to the module README.md to reflect the new argument(s) and feature(s). 
- Make sure all source and unit test file changes are lint-test acceptable.
